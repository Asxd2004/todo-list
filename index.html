<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>To-Do List</title>
  <style>
    :root { --max-w: 700px; }
    body{
      margin:0;
      min-height:100vh;
      font-family: Arial, Helvetica, sans-serif;
      /* Animated gradient background */
      background: linear-gradient(270deg, #ff9a9e, #fad0c4, #fbc2eb, #a18cd1);
      background-size: 800% 800%;
      animation: gradientBG 18s ease infinite;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      box-sizing:border-box;
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .container{
      width:100%;
      max-width:var(--max-w);
      background: rgba(255, 255, 255, 0.15);
      border-radius:20px;
      padding:20px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    h1 { text-align:center; margin:0 0 14px 0; color:#fff; }
    .form-group { display:flex; gap:10px; margin-bottom:12px; }
    .form-group input[type="text"]{
      flex:1; padding:10px 12px; border:1px solid #e10b61; border-radius:6px; font-size:16px;
    }
    .form-group button{
      padding:10px 16px; border-radius:6px; border:none; background:#28a745; color:#fff; cursor:pointer;
      transition: 0.3s;
    }
    .form-group button:hover { transform: scale(1.05); }
    .controls { display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:8px; flex-wrap:wrap; }
    .controls button { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; font-weight:600; }
    #clearBtn { background:#e74c3c; color:white; }
    #exportBtn { background:#3498db; color:white; }
    /* Unique Import button with gradient + hover */
    #importBtn {
      background: linear-gradient(135deg, #ff7eb3, #8e44ad);
      color: white;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    #importBtn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(142, 68, 173, 0.5);
    }
    #taskCount { color:#fff; font-weight:600; }
    ul.task-list { list-style:none; padding:0; margin:0; max-height:60vh; overflow:auto; }
    .task {
      display:flex; justify-content:space-between; align-items:center;
      padding:10px; border-bottom:1px solid rgba(255,255,255,0.3);
      color:#fff;
      transition:0.3s;
    }
    .task:hover {
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
    }
    .task-left { display:flex; align-items:center; gap:10px; }
    .task-left span { font-size:15px; }
    .task-left span.completed { text-decoration:line-through; color:#64bc65; }
    .task-actions button { margin-left:8px; padding:6px 10px; border-radius:6px; border:none; cursor:pointer; }
    .task-actions .edit { background:#f39c12; color:white; }
    .task-actions .delete { background:#e74c3c; color:white; }
    @media (max-width:480px){ .form-group button { padding:10px 12px; } }
  </style>
</head>
<body>
  <div class="container" role="main">
    <h1>To-Do List</h1>

    <form id="taskForm" class="form-group" autocomplete="off">
      <input type="text" id="taskInput" placeholder="Enter your task" aria-label="New task">
      <button type="submit">Add Task</button>
    </form>

    <div class="controls">
      <div>
        <button id="clearBtn" type="button">Clear All</button>
        <button id="exportBtn" type="button">Export</button>
        <button id="importBtn" type="button">Import</button>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>
      <div id="taskCount">0 tasks</div>
    </div>

    <ul id="taskList" class="task-list" aria-live="polite"></ul>
  </div>

  <script>
    // Elements
    const taskForm = document.getElementById('taskForm');
    const taskInput = document.getElementById('taskInput');
    const taskListEl = document.getElementById('taskList');
    const clearBtn = document.getElementById('clearBtn');
    const taskCountEl = document.getElementById('taskCount');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const importFile = document.getElementById('importFile');

    // State
    let tasks = [];

    // Load safely from localStorage
    function loadTasks() {
      try {
        const raw = localStorage.getItem('tasks');
        tasks = raw ? JSON.parse(raw) : [];
        if (!Array.isArray(tasks)) tasks = [];
      } catch (e) {
        console.error('Error reading tasks from localStorage, resetting.', e);
        tasks = [];
      }
    }

    function saveTasks(){
      localStorage.setItem('tasks', JSON.stringify(tasks));
      updateCount();
    }

    function updateCount(){
      const total = tasks.length;
      const remaining = tasks.filter(t => !t.completed).length;
      taskCountEl.textContent = `${remaining} / ${total} tasks`;
    }

    // Render
    function renderTasks() {
      taskListEl.innerHTML = '';
      if (tasks.length === 0) {
        const p = document.createElement('p');
        p.textContent = 'No tasks yet â€” add one!';
        p.style.color = '#fff';
        taskListEl.appendChild(p);
        updateCount();
        return;
      }

      tasks.forEach(task => {
        const li = document.createElement('li');
        li.className = 'task';

        // Left: checkbox + text
        const left = document.createElement('div');
        left.className = 'task-left';

        const chk = document.createElement('input');
        chk.type = 'checkbox';
        chk.checked = !!task.completed;
        chk.setAttribute('aria-label', 'Mark task complete');
        chk.addEventListener('change', () => toggleComplete(task.id));

        const span = document.createElement('span');
        span.textContent = task.text;
        if (task.completed) span.classList.add('completed');

        left.appendChild(chk);
        left.appendChild(span);

        // Actions
        const actions = document.createElement('div');
        actions.className = 'task-actions';

        const editBtn = document.createElement('button');
        editBtn.type = 'button';
        editBtn.className = 'edit';
        editBtn.textContent = 'Edit';
        editBtn.addEventListener('click', () => editTask(task.id));

        const delBtn = document.createElement('button');
        delBtn.type = 'button';
        delBtn.className = 'delete';
        delBtn.textContent = 'Delete';
        delBtn.addEventListener('click', () => deleteTask(task.id));

        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        li.appendChild(left);
        li.appendChild(actions);
        taskListEl.appendChild(li);
      });
      updateCount();
    }

    // Add task (called on submit)
    function addTask(e) {
      if (e) e.preventDefault();
      const text = taskInput.value.trim();
      if (!text) {
        alert('Task cannot be empty!');
        return;
      }
      // Use Date.now() to avoid NaN/id collisions
      const task = { id: Date.now(), text, completed: false };
      tasks.push(task);
      saveTasks();
      renderTasks();
      taskInput.value = '';
      taskInput.focus();
    }

    function deleteTask(id) {
      if (!confirm('Are you sure you want to delete this task?')) return;
      tasks = tasks.filter(t => t.id !== id);
      saveTasks();
      renderTasks();
    }

    function editTask(id) {
      const t = tasks.find(x => x.id === id);
      if (!t) return;
      const newText = prompt('Update your task:', t.text);
      if (newText === null) return; // cancelled
      if (newText.trim() === '') { alert('Task cannot be empty!'); return; }
      t.text = newText.trim();
      saveTasks();
      renderTasks();
    }

    function toggleComplete(id) {
      const t = tasks.find(x => x.id === id);
      if (!t) return;
      t.completed = !t.completed;
      saveTasks();
      renderTasks();
    }

    clearBtn.addEventListener('click', () => {
      if (!confirm('Clear all tasks?')) return;
      tasks = [];
      saveTasks();
      renderTasks();
    });

    // Export/import simple JSON
    exportBtn.addEventListener('click', () => {
      const dataStr = JSON.stringify(tasks, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'todo-export.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    importBtn.addEventListener('click', () => importFile.click());
    importFile.addEventListener('change', (ev) => {
      const f = ev.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const imported = JSON.parse(reader.result);
          if (!Array.isArray(imported)) throw new Error('Invalid file');
          // optional: merge or replace -> here we replace
          tasks = imported.map(t => ({
            id: typeof t.id === 'number' ? t.id : Date.now() + Math.random(),
            text: String(t.text || ''),
            completed: !!t.completed
          }));
          saveTasks();
          renderTasks();
          alert('Import successful!');
        } catch (err) {
          alert('Import failed: invalid JSON file.');
        }
      };
      reader.readAsText(f);
      ev.target.value = ''; // reset
    });

    // Init
    loadTasks();
    renderTasks();

    // Form submit (handles pressing Enter inside input)
    taskForm.addEventListener('submit', addTask);
  </script>
</body>
</html>
